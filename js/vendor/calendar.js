if("undefined"==typeof jQuery)throw new Error("jQuery is not loaded");$.fn.zabuto_calendar=function(a){var t=$.extend({},$.fn.zabuto_calendar_defaults(),a),e=$.fn.zabuto_calendar_language(t.language);return t=$.extend({},t,e),this.each(function(){function a(){var a=parseInt(w.data("initYear")),t=parseInt(w.data("initMonth"))-1,d=new Date(a,t,1,0,0,0,0);w.data("initDate",d);var r=w.data("cellBorder")===!0?" table-bordered":"";$tableObj=$('<table class="table'+r+'"></table>'),$tableObj=e(w,$tableObj,d.getFullYear(),d.getMonth()),$legendObj=n(w);var o=$('<div class="zabuto_calendar" id="'+w.attr("id")+'"></div>');o.append($tableObj),o.append($legendObj),w.append(o);var i=w.data("jsonData");!1!==i&&s(w,d.getFullYear(),d.getMonth())}function e(a,t,e,n){var d=new Date(e,n,1,0,0,0,0);return a.data("currDate",d),t.empty(),t=r(a,t,e,n),t=o(a,t),t=i(a,t,e,n),s(a,e,n),t}function n(a){var t=$('<div class="legend" id="'+a.attr("id")+'_legend"></div>'),e=a.data("legendList");return"object"==typeof e&&e.length>0&&$(e).each(function(a,e){if("object"==typeof e&&"type"in e){var n="";switch("label"in e&&(n=e.label),e.type){case"text":if(""!==n){var d="";if("badge"in e){if("undefined"==typeof e.classname)var r="badge-event";else var r=e.classname;d='<span class="badge '+r+'">'+e.badge+"</span> "}t.append('<span class="legend-'+e.type+'">'+d+n+"</span>")}break;case"block":if(""!==n&&(n="<span>"+n+"</span>"),"undefined"==typeof e.classname)var o="event";else var o="event-styled "+e.classname;t.append('<span class="legend-'+e.type+'"><ul class="legend"><li class="'+o+'"></li></u>'+n+"</span>");break;case"list":if("list"in e&&"object"==typeof e.list&&e.list.length>0){var i=$('<ul class="legend"></u>');$(e.list).each(function(a,t){i.append('<li class="'+t+'"></li>')}),t.append(i)}break;case"spacer":t.append('<span class="legend-'+e.type+'"> </span>')}}}),t}function r(a,t,n,d){var r=a.data("navIcons"),o=$('<span><span class="glyphicon glyphicon-chevron-left"></span></span>'),i=$('<span><span class="glyphicon glyphicon-chevron-right"></span></span>');"object"==typeof r&&("prev"in r&&o.html(r.prev),"next"in r&&i.html(r.next));var l=a.data("showPrevious");("number"==typeof l||l===!1)&&(l=_(a.data("showPrevious"),!0));var s=$('<div class="calendar-month-navigation"></div>');s.attr("id",a.attr("id")+"_nav-prev"),s.data("navigation","prev"),l!==!1&&(prevMonth=d-1,prevYear=n,-1==prevMonth&&(prevYear-=1,prevMonth=11),s.data("to",{year:prevYear,month:prevMonth+1}),s.append(o),"function"==typeof a.data("actionNavFunction")&&s.click(a.data("actionNavFunction")),s.click(function(n){e(a,t,prevYear,prevMonth)}));var c=a.data("showNext");("number"==typeof c||c===!1)&&(c=_(a.data("showNext"),!1));var p=$('<div class="calendar-month-navigation"></div>');p.attr("id",a.attr("id")+"_nav-next"),p.data("navigation","next"),c!==!1&&(nextMonth=d+1,nextYear=n,12==nextMonth&&(nextYear+=1,nextMonth=0),p.data("to",{year:nextYear,month:nextMonth+1}),p.append(i),"function"==typeof a.data("actionNavFunction")&&p.click(a.data("actionNavFunction")),p.click(function(n){e(a,t,nextYear,nextMonth)}));var v=a.data("monthLabels"),u=$("<th></th>").append(s),f=$("<th></th>").append(p),h=$("<span>"+v[d]+" "+n+"</span>");h.dblclick(function(){var n=a.data("initDate");e(a,t,n.getFullYear(),n.getMonth())});var b=$('<th colspan="5"></th>');b.append(h);var g=$('<tr class="calendar-month-header"></tr>');return g.append(u,b,f),t.append(g),t}function o(a,t){if(a.data("showDays")===!0){var e=a.data("weekStartsOn"),n=a.data("dowLabels");if(0===e){var d=$.extend([],n),r=new Array(d.pop());n=r.concat(d)}var o=$('<tr class="calendar-dow-header"></tr>');$(n).each(function(a,t){o.append("<th>"+t+"</th>")}),t.append(o)}return t}function i(a,t,e,n){var d=(a.data("ajaxSettings"),g(e,n)),r=b(e,n),o=h(e,n,1),i=h(e,n,r),l=1,s=a.data("weekStartsOn");0===s&&(6==i&&d++,6!=o||0!=i&&1!=i&&5!=i||d--,o++,7==o&&(o=0));for(var c=0;d>c;c++){for(var p=$('<tr class="calendar-dow"></tr>'),v=0;7>v;v++){if(o>v||l>r)p.append("<td></td>");else{var y=a.attr("id")+"_"+f(e,n,l),m=y+"_day",_=$('<div id="'+m+'" class="day" >'+l+"</div>");_.data("day",l),a.data("showToday")===!0&&u(e,n,l)&&_.html('<span class="badge badge-today">'+l+"</span>");var w=$('<td id="'+y+'"></td>');w.append(_),w.data("date",f(e,n,l)),w.data("hasEvent",!1),"function"==typeof a.data("actionFunction")&&(w.addClass("dow-clickable"),w.click(function(){a.data("selectedDate",$(this).data("date"))}),w.click(a.data("actionFunction"))),p.append(w),l++}6==v&&(o=0)}t.append(p)}return t}function l(a,t,e,n){var d=$('<button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>'),r=$('<h4 class="modal-title" id="'+a+'_modal_title">'+t+"</h4>"),o=$('<div class="modal-header"></div>');o.append(d),o.append(r);var i=$('<div class="modal-body" id="'+a+'_modal_body">'+e+"</div>"),l=$('<div class="modal-footer" id="'+a+'_modal_footer"></div>');if("undefined"!=typeof n){var s=$("<div>"+n+"</div>");l.append(s)}var c=$('<div class="modal-content"></div>');c.append(o),c.append(i),c.append(l);var p=$('<div class="modal-dialog"></div>');p.append(c);var v=$('<div class="modal fade" id="'+a+'_modal" tabindex="-1" role="dialog" aria-labelledby="'+a+'_modal_title" aria-hidden="true"></div>');return v.append(p),v.data("dateId",a),v.attr("dateId",a),v}function s(a,t,e){var n=a.data("jsonData"),d=a.data("ajaxSettings");return a.data("events",!1),!1!==n?c(a):!1!==d?p(a,t,e):!0}function c(a){var t=a.data("jsonData");return a.data("events",t),v(a,"json"),!0}function p(a,t,e){var n=a.data("ajaxSettings");if("object"!=typeof n||"undefined"==typeof n.url)return alert("Invalid calendar event settings"),!1;var d={year:t,month:e+1};return $.ajax({type:"GET",url:n.url,data:d,dataType:"json"}).done(function(t){var e=[];$.each(t,function(a,n){e.push(t[a])}),a.data("events",e),v(a,"ajax")}),!0}function v(a,t){var e=(a.data("jsonData"),a.data("ajaxSettings")),n=a.data("events");n!==!1&&$(n).each(function(n,d){var r=a.attr("id")+"_"+d.date,o=$("#"+r),i=$("#"+r+"_day");if(o.data("hasEvent",!0),"undefined"!=typeof d.title&&o.attr("title",d.title),"undefined"==typeof d.classname?o.addClass("event"):(o.addClass("event-styled"),i.addClass(d.classname)),"undefined"!=typeof d.badge&&d.badge!==!1){var s=d.badge===!0?"":" badge-"+d.badge,c=i.data("day");i.html('<span class="badge badge-event'+s+'">'+c+"</span>")}if("undefined"!=typeof d.body){var p=!1;if("json"===t&&"undefined"!=typeof d.modal&&d.modal===!0?p=!0:"ajax"===t&&"modal"in e&&e.modal===!0&&(p=!0),p===!0){o.addClass("event-clickable");var v=l(r,d.title,d.body,d.footer);$("body").append(v),$("#"+r).click(function(){$("#"+r+"_modal").modal()})}}})}function u(a,t,e){var n=new Date,d=new Date(a,t,e);return d.toDateString()==n.toDateString()}function f(a,t,e){return d=10>e?"0"+e:e,m=t+1,m=m<10?"0"+m:m,a+"-"+m+"-"+d}function h(a,t,e){var n=new Date(a,t,e,0,0,0,0),d=n.getDay();return 0==d?d=6:d--,d}function b(a,t){for(var e=28;y(a,t+1,e+1);)e++;return e}function g(a,t){var e=b(a,t),n=h(a,t,1),d=h(a,t,e),r=e,o=n-d;return o>0&&(r+=o),Math.ceil(r/7)}function y(a,t,e){return t>0&&13>t&&a>0&&32768>a&&e>0&&e<=new Date(a,t,0).getDate()}function _(a,t){a===!1&&(a=0);var e,n=w.data("currDate"),d=w.data("initDate");if(e=12*(d.getFullYear()-n.getFullYear()),e-=n.getMonth()+1,e+=d.getMonth(),t===!0){if(e<parseInt(a)-1)return!0}else if(e>=0-parseInt(a))return!0;return!1}var w=$(this);w.attr("id","zabuto_calendar_"+Math.floor(99999*Math.random()).toString(36)),w.data("initYear",t.year),w.data("initMonth",t.month),w.data("monthLabels",t.month_labels),w.data("weekStartsOn",t.weekstartson),w.data("navIcons",t.nav_icon),w.data("dowLabels",t.dow_labels),w.data("showToday",t.today),w.data("showDays",t.show_days),w.data("showPrevious",t.show_previous),w.data("showNext",t.show_next),w.data("cellBorder",t.cell_border),w.data("jsonData",t.data),w.data("ajaxSettings",t.ajax),w.data("legendList",t.legend),w.data("actionFunction",t.action),w.data("actionNavFunction",t.action_nav),a()}),this},$.fn.zabuto_calendar_defaults=function(){var a=new Date,t=a.getFullYear(),e=a.getMonth()+1,n={language:!1,year:t,month:e,show_previous:!0,show_next:!0,cell_border:!1,today:!1,show_days:!0,weekstartson:1,nav_icon:!1,data:!1,ajax:!1,legend:!1,action:!1,action_nav:!1};return n},$.fn.zabuto_calendar_language=function(a){switch(("undefined"==typeof a||a===!1)&&(a="en"),a.toLowerCase()){case"en":return{month_labels:["January","February","March","April","May","June","July","August","September","October","November","December"],dow_labels:["M","T","W","T","F","S","S"]}}},$(document).ready(function(){$("#my-calendar").zabuto_calendar({legend:[{type:"text",label:"Special event",badge:"00"},{type:"block",label:"Regular event",classname:"purple"},{type:"spacer"},{type:"text",label:"Bad"},{type:"list",list:["grade-1","grade-2","grade-3","grade-4"]},{type:"text",label:"Good"}],ajax:{url:"show_data.php?grade=1"}})});
